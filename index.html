<!DOCTYPE html>
<html lang="en">
<head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moths for Anna</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Georgia, serif; background-color: #faf9f7; color: #2d2d2d; padding: 40px 20px; }
        header { text-align: center; margin-bottom: 40px; }
        h1 { font-family: "Uncial Antiqua"; font-weight: normal; font-size: 2em; margin-bottom: 10px; }
        .subtitle { color: #888; font-size: 1.1em; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; max-width: 1400px; margin: 0 auto; }
        .moth-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s; }
        .moth-card:hover { transform: translateY(-4px); }
        .moth-card a { display: block; }
        .moth-card img { width: 100%; height: 250px; object-fit: cover; cursor: pointer; }
        .moth-info { padding: 20px; text-align: center; }
        .moth-number { font-size: 12px; color: #888; margin-bottom: 3px; }
        .moth-name { font-size: 1.3em; margin-bottom: 5px; }
        .scientific-name { font-style: italic; color: #666; margin-bottom: 10px; }
        .family { font-size: 0.9em; color: #555; margin-bottom: 5px; }
        .location { font-size: 0.9em; color: #888; margin-bottom: 5px; }
        .timestamp { font-size: 0.8em; color: #aaa; margin-bottom: 6px}
        .loading { text-align: center; padding: 60px; color: #888; }
        a { color: inherit; text-decoration: none; }
    </style>
</head>
<body>
    <header>
        <h1>ü¶ã Moths for Anna ü¶ã</h1>
        <p class="subtitle">A new moth (or caterpillar) every hour.</p>
    </header>
    <div id="moths" class="grid">
        <div class="loading">Loading moths...</div>
    </div>
    <script>
        const GIST_ID = '13f60f151dac089590b88b9a55c4140e';
        
        function formatDate(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', { 
                timeZone: 'America/Los_Angeles',
                month: 'short', 
                day: 'numeric', 
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }
        
        async function loadMoths() {
            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`);
                const gist = await response.json();
                const moths = JSON.parse(gist.files['sent_moths.json'].content);
                const container = document.getElementById('moths');
                if (!moths.length) {
                    container.innerHTML = '<div class="loading">No moths yet. Check back soon!</div>';
                    return;
                }
                const sorted = moths.reverse();
                container.innerHTML = sorted.map(moth => `
                    <div class="moth-card">
                        <a href="${moth.observation_url}" target="_blank">
                            <img src="${moth.photo_url}" alt="${moth.common_name}">
                        </a>
                        <div class="moth-info">
                            <div class="moth-number">Moth #${moth.moth_number || ''}</div>
                            <div class="timestamp">${formatDate(moth.sent_at)}</div>
                            <div class="moth-name">${moth.common_name}</div>
                            <div class="scientific-name">${moth.scientific_name}</div>
                            ${moth.family ? `<div class="family">Family: ${moth.family}</div>` : ''}
                            <div class="location">üìç ${moth.place}</div>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                document.getElementById('moths').innerHTML = '<div class="loading">Error loading moths</div>';
            }
        }
        loadMoths();
    </script>
</body>
</html>
